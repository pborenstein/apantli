<!DOCTYPE html>
<html>
<head>
    <title>apantli ≈ compare</title>
    <link rel="icon" href="/static/favicon.ico" sizes="32x32">
    <link rel="apple-touch-icon" href="/static/apple-touch-icon.png">
    <link rel="manifest" href="/static/site.webmanifest">
    <script>
        // Version marker to help debug caching issues
        window.APANTLI_VERSION = '2025-11-05-002';
    </script>
    <script defer src="/static/alpine-persist.min.js"></script>
    <script defer src="/static/alpine.min.js"></script>
    <link rel="stylesheet" href="/static/css/dashboard.css">
    <link rel="stylesheet" href="/static/css/compare.css?v=20251105-2">
</head>
<body x-data="compareApp()" x-init="init()" :data-theme="theme">
    <header class="header">
        <div class="header-content">
            <h1 class="header-title">
                <img src="/static/apantli-glyph.png" alt="apantli" class="header-glyph">
                apantli ≈ compare
            </h1>
            <div class="header-actions">
                <a href="/" class="btn btn-secondary">Dashboard</a>
            </div>
        </div>
    </header>

    <main class="main-content">
        <!-- Input Area -->
        <section class="input-panel">
            <div class="input-area">
                <textarea
                    x-model="currentPrompt"
                    placeholder="Type your message here..."
                    rows="2"
                    @keydown.ctrl.enter="sendToAll()"
                    @keydown.meta.enter="sendToAll()"
                    :disabled="isLoading"></textarea>
                <div class="input-actions">
                    <button class="btn btn-secondary btn-small" @click="clearPrompt()" :disabled="isLoading || !currentPrompt">
                        Clear
                    </button>
                    <button class="btn btn-primary btn-small" @click="sendToAll()" :disabled="isLoading || !currentPrompt || enabledCount() === 0">
                        <span x-show="!isLoading" x-text="`Send (${enabledCount()})`"></span>
                        <span x-show="isLoading">Sending...</span>
                    </button>
                </div>
            </div>
        </section>

        <!-- Model Configuration Panel -->
        <section class="config-panel">
            <details open>
                <summary>Model Configuration</summary>
            <div class="config-slots">
                <template x-for="(slot, index) in slots" :key="index">
                    <div class="config-slot" :class="{ 'disabled': !slot.enabled }">
                        <div class="slot-header">
                            <label class="slot-toggle">
                                <input type="checkbox" x-model="slot.enabled" @change="saveState()">
                                <span x-text="`Slot ${String.fromCharCode(65 + index)}`"></span>
                            </label>
                        </div>

                        <template x-if="slot.enabled">
                            <div class="slot-config">
                                <div class="form-group">
                                    <label>Model</label>
                                    <select x-model="slot.model" @change="applyModelDefaults(index)">
                                        <template x-for="model in availableModels" :key="model">
                                            <option :value="model" x-text="model"></option>
                                        </template>
                                    </select>
                                </div>

                                <div class="form-group">
                                    <div class="param-header">
                                        <label title="Controls randomness: higher values (>1) = more creative/random, lower values (<1) = more focused/deterministic">
                                            Temperature
                                        </label>
                                        <button
                                            type="button"
                                            class="btn-reset"
                                            @click="resetParameter(index, 'temperature')"
                                            :title="`Reset to ${getDefaultValue(index, 'temperature').toFixed(1)}`">
                                            ↺
                                        </button>
                                    </div>
                                    <input
                                        type="number"
                                        min="0"
                                        max="2"
                                        step="0.1"
                                        x-model.number="slot.temperature"
                                        @input="saveState()"
                                        title="Controls randomness: higher values (>1) = more creative/random, lower values (<1) = more focused/deterministic">
                                </div>

                                <div class="form-group">
                                    <div class="param-header">
                                        <label title="Controls diversity via nucleus sampling: lower values (<0.9) = more focused, higher values (>0.9) = more variety">
                                            Top P
                                        </label>
                                        <button
                                            type="button"
                                            class="btn-reset"
                                            @click="resetParameter(index, 'top_p')"
                                            :title="`Reset to ${getDefaultValue(index, 'top_p').toFixed(2)}`">
                                            ↺
                                        </button>
                                    </div>
                                    <input
                                        type="number"
                                        min="0"
                                        max="1"
                                        step="0.01"
                                        x-model.number="slot.top_p"
                                        @input="saveState()"
                                        title="Controls diversity via nucleus sampling: lower values (<0.9) = more focused, higher values (>0.9) = more variety">
                                </div>

                                <div class="form-group">
                                    <div class="param-header">
                                        <label>Max Tokens</label>
                                        <button
                                            type="button"
                                            class="btn-reset"
                                            @click="resetParameter(index, 'max_tokens')"
                                            :title="`Reset to ${getDefaultValue(index, 'max_tokens')}`">
                                            ↺
                                        </button>
                                    </div>
                                    <input
                                        type="number"
                                        min="1"
                                        max="32000"
                                        x-model.number="slot.max_tokens"
                                        @input="saveState()">
                                </div>
                            </div>
                        </template>
                    </div>
                </template>
            </div>

            <div class="panel-actions">
                <button class="btn btn-secondary btn-small" @click="newConversation()">New Conversation</button>
            </div>
            </details>
        </section>

        <!-- Conversation Display -->
        <section class="conversation-panel">
            <div class="conversation-columns">
                <template x-for="(slot, index) in slots" :key="index">
                    <div class="conversation-column" :class="{ 'disabled': !slot.enabled }">
                        <div class="column-header">
                            <div class="column-title">
                                <span x-show="!slot.enabled">Slot disabled</span>
                                <span x-show="slot.enabled" x-text="slot.conversationModel || slot.model"></span>
                                <span x-show="slot.enabled && slot.conversationModel && slot.conversationModel !== slot.model"
                                      style="color: var(--color-warning); font-size: 0.7rem; margin-left: 4px;"
                                      title="Model changed - conversation still using original model">
                                    ⚠️
                                </span>
                            </div>
                            <div class="column-params" x-show="slot.enabled">
                                <span x-text="`temp=${slot.temperature.toFixed(1)}`"></span>,
                                <span x-text="`top_p=${slot.top_p.toFixed(2)}`"></span>
                            </div>
                        </div>

                        <div class="column-messages" x-show="slot.enabled">
                            <template x-if="slot.messages.length === 0">
                                <div class="empty-state">No messages yet</div>
                            </template>

                            <template x-for="(msg, msgIndex) in slot.messages" :key="msgIndex">
                                <div class="message" :class="`message-${msg.role}`">
                                    <div class="message-role" x-text="msg.role.toUpperCase()"></div>
                                    <div class="message-content" x-text="msg.content"></div>
                                    <div class="message-meta" x-show="msg.tokens" x-text="msg.tokens ? `${msg.tokens.prompt}→${msg.tokens.completion} tokens (${msg.tokens.total} total)` : ''"></div>
                                </div>
                            </template>

                            <template x-if="slot.streaming">
                                <div class="message message-assistant">
                                    <div class="message-role">ASSISTANT</div>
                                    <div class="message-content" x-text="slot.streamingContent"></div>
                                </div>
                            </template>
                        </div>
                    </div>
                </template>
            </div>
        </section>
    </main>

    <footer style="text-align: center; padding: 2rem 1rem; margin-top: 3rem; border-top: 1px solid var(--border-color); font-size: 0.9rem; color: var(--text-secondary);">
        <a href="https://apantli.app" style="color: var(--text-primary); text-decoration: none;">apantli</a>
        &copy; 2025
        <a href="https://pborenstein.dev" style="color: var(--text-primary); text-decoration: none;">Philip Borenstein</a>
        /
        Made in New England
        <svg style="display: inline-block; width: 20px; height: 12px; margin-left: 4px; vertical-align: middle;" viewBox="0 0 720 432" xmlns="http://www.w3.org/2000/svg">
            <rect fill="#BF0000" width="720" height="432"/>
            <rect fill="#FFFFFF" width="216" height="216"/>
            <path fill="#8B5C29" d="M114.15,170.029c0.014,5.968-0.477,11.827-0.515,17.716c-0.014,2.087,0.094,4.623,0.532,6.655c0.371,1.723,1.579,3.449,1.61,5.309c1.604,0.192,1.417,2.074,2.89,2.24c3.276,5.972-4.25,4.03-8.133,4.017c-2.596-0.009-5.317,0.471-7.708,0.374c-2.542-0.102-4.343-0.099-6.985,0.693c0.775-0.864,1.915-1.14,2.653-2.073c1.315-1.661,0.982-3.981,1.256-5.948c0.48-3.446,0.51-6.72,0.543-10.222c0.03-3.22,0.646-6.491,1.014-9.534c0.379-3.143,0.017-6.566,0.012-9.74"/>
            <path fill="#00A33D" d="M106.451,177.728c-0.659,0.771-2.116,2.905-3.317,2.956c-0.677,0.028-0.791-0.767-1.382-0.835c-1.293-0.15-2.95-0.131-4.254-0.084c-3.118,0.112-6.175,0.19-9.288-0.195c-5.419-0.671-9.691-0.84-14.821,1.004c-2.198,0.791-4.47,0.994-6.891,0.757c-2.634-0.257-5.513-0.324-8.1-0.917c-2.044-0.468-5.359-1.641-3.124-4.239c2.086-2.422,5.909-0.999,7.908-2.977c-5.916-0.576-11.514,1.969-17.245,1.207c-2.225-0.295-6.479-0.411-4.526-3.638c1.237-2.043,4.039-3.845,4.58-6.283c1.443-0.231,2.658-2.697,3.968-3.55c1.415-0.921,3.485-1.811,5.079-2.284c0.805-2.183-1.333-2.853-1.97-4.477c-0.942-2.404,1.583-3.115,2.159-5.085c0.276-0.067,0.552-0.133,0.829-0.197c0.064-0.276,0.129-0.554,0.196-0.83c0.945-0.081,2.306-1.621,2.98-2.273c0.959-0.927,3.269-2.896,3.555-3.886c-3.207,0.052-0.782-3.19,0.211-4.096c1.622-1.482,3.088-2.2,4.813-3.332c1.044-0.686,3.19-2.747,2.736-4.204c-0.56-1.798-3.338-1.085-4.04-2.892c-1.123-2.891,3.778-7.663,5.296-10.006c1.02-1.576,2.386-2.687,3.733-3.944c1.773-1.655,2.878-3.862,4.573-5.562c-3.283,0.325-6.411-0.641-9.504-0.528c-1.313-3.878,6.129-7.486,8.178-9.531c1.532-1.53,2.78-3.687,4.41-5.291c1.409-1.387,3.391-4.042,5.114-4.628c-2.75-0.049-5.117,2.07-7.951,1.488c-0.66-2.025,3.381-6.556,4.343-8.393c1.374-2.622,4.216-5.47,4.853-8.503c1.038-4.941-3.487-2.807-4.999-5.742c-1.485-2.881,4.017-4.102,4.961-5.451c0.809-1.155,0.862-3.811,0.021-4.947c-0.834-1.126-2.029-0.736-2.104-2.371c-0.132-2.932,3.591-5.725,4.49-8.142c0.585-1.572-0.176-3.076-0.337-4.579c-0.174-1.611,0.401-3.653,1.082-5.035c0.461-0.936,1.487-1.887,1.98-3.054c0.356-0.846,0.654-1.671,1.024-2.52c0.759-1.744,1.573-3.308,2.331-5.197c0.955-2.379,3.654-3.548,4.824-5.754c0.821-1.548,0.292-3.377,1.16-4.991c0.654-1.212,1.341-1.934,1.723-3.256c-0.185-0.106-0.278-0.277-0.284-0.515l4.106-3.592c0.703,1.062,0.862,2.783,1.405,3.979c0.49,1.08,0.988,2.156,1.548,3.204c0.768,1.439,1.522,2.849,2.084,4.2c1.38,3.323,2.236,6.437,3.909,9.645c0.758,1.453,1.75,2.673,2.355,4.079c0.779,1.809,0.788,3.547,1.253,5.419c0.43,1.733,1.391,3.207,1.798,4.881c0.417,1.71,2.248,4.455,2.006,6.087c-0.787,0.03-1.67,0.012-2.447,0.181c1.553,3.237,5.245,5.556,7.414,8.364c1.064,1.38,1.237,2.384,1.79,3.822c0.419,1.092,1.137,2.117,1.003,3.32c-0.06,0.541-0.567,1.026-0.594,1.754c-0.285,0.056-0.569,0.113-0.853,0.173c-0.58,1.76,0.959,3.569,1.704,5.048c1.098,2.178,0.684,2.021-0.389,4.066c-1.116,2.13-0.914,3.538-0.366,5.683c0.306,1.2,0.131,1.724,1.006,2.83c0.613,0.774,1.451,1.217,1.646,2.202c0.275,0.072,0.553,0.134,0.833,0.189c0.268,1.856,3.144,3.968,2.693,6.083c-0.533,2.495-3.82,1.715-0.563,4.817c2.303,2.195,8.194,5.46,7.652,9.463c-2.047,0.115-3.539,1.29-5.513,1.193c0.25,1.777,3.247,2.755,4.385,4.131c1.618,1.956,2.957,4.649,5.307,5.831c2.662,1.338,11.009,4.133,4.625,7.38c-1.801,0.915-10.238,0.596-9.015,3.635c1.022,2.539,5.035,1.692,1.314,4.172c-2.718,1.812-4.869,1.769-8.094,2.18c0.958,1.79,4.134,4.129,5.709,4.846c1.166,0.532,2.744,0.302,4.004,0.662c3.18,0.906,5.853,2.899,8.916,4.088c2.311,0.897,4.728,1.903,6.799,2.995c1.963,1.036,3.902,3.257,5.921,4.206c-2.742,1.363-8.363,3.684-11.745,3.556c-1.226-0.047-1.769-0.463-3.103-0.333c-1.995,0.195-3.461,0.956-5.506,0.78c3.402,1.388,8.062,0.741,10.97,3.062c2.256,1.8,2.247,4.787,5.378,5.921c2.095,0.758,4.279,0.754,6.477,1.388c1.771,0.512,3.354,0.634,5.062,1.057c1.856,0.458,1.959,1.229,2.508,2.864c-0.933,0.627-2.056,0.844-3.046,1.4c-1.701,0.958-2.596,2.857-4.1,3.766c-2.162,1.306-6.182,2.48-8.712,2.148c-3.652-0.479-6.491,0.374-10.233,0.496c-2.258,0.075-4.304,1.029-6.563,1.107c1.459,1.327,2.812,2.674,4.452,3.811c1.666,1.155,3.636,1.812,5.079,3.412c-0.984,2.847-8.668,1.344-10.879,0.849c-1.995-0.448-3.829-0.442-5.926-0.451c-3.283-0.015-5.539-0.708-8.729-1.309c-9.681-1.825-16.693-10.305-27.197-8.89c-0.019,0.789,0.374,1.167,0.973,1.464L106.451,177.728z"/>
        </svg>
    </footer>

    <script src="/static/js/compare.js?v=20251105-2"></script>
</body>
</html>
